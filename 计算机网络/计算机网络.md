# 1.TCP/IP如何实现可靠传输
    1. 基础是滑动窗口协议和连续ARQ协议来保证传输效率，配合着流量控制和拥塞控制
    2.1 停止等待协议和自动重传请求(ARQ)：发送完一个分组后，等待确认报文再发送
        2.1.1 未收到确认：采用超时计时器，若长时间未收到确认，则重发
        2.1.2 收到重复分组：丢弃分组并发送确认
    2.2 滑动窗口协议和连续ARQ协议（连续ARQ是基于滑动窗口实现）：传输方式
        2.2.1 使用滑动窗口协议，接收方采用累计确认的方式，对按序到达的最后一个分组进行确认
    2.3 流量控制（利用可变的窗口大小）（点对点的接收问题，使得接收方来得及接收）
        2.3.1 接收方通过发送seq(序列号),qwnd(窗口大小)，来告知发送方下一次发送的数据量
    2.4 拥塞控制（防止过多的数据注入到网络中）
        2.4.1 慢开始和拥塞避免：指数增长，
        2.4.2 拥塞避免：到了门限值以后线性增长
        2.4.3 快重传：（快重传）接受方收到报文就发送确认，当发送方收到三个重复确认当立即重传(比如说12345，收到12，缺3，那他回复的应该是333)
        2.4.4 快恢复: 当收到三个重复的确认后，采用快恢复，即门限值除2，然后采用拥塞避免线性增长
        2.4.5 若超时，则直接归零
# 2.TCP建立可靠的连接（连接的三次握手，释放的四次握手）
    0.TCP标志位：SYN(synchronous建立联机) ACK(acknowledgement 确认)FIN(finish结束) ，Sequence number(顺序号码) Acknowledge number(确认号码) PSH(push传送) RST(reset重置) URG(urgent紧急)
    1.目的：为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
    2.连接握手（请求---应答---确认）：
        2.1 客户端发出【连接请求】报文段（建立联机syn = 1， 序列号seq = 123）
        2.2 服务端收到连接请求报文段后，如同意，则发回【确认连接】的报文（ack number = Seq +1 ,syn = 1,ack = 1,seq = 321）
        2.3 客户端收到同意连接的报文段后，向服务端给出【确认连接】的报文，并通知上层应用进程，连接已经建立。（ack number = seq + 1,ack = 1）
        2.4 服务端收到确认后，通知上层，连接已建立
        2.5 开始数据传输
    3.释放松手（释放-确认释放-连接关闭-确认关闭）：
        3.1 客户端发出【连接释放】报文段，然后停止发送数据，关闭TCP连接，（Fin = 1 ,seq = 456）
        3.2 服务端发出【确认释放】报文段，通知高层进程，此时TCP处于半关闭，若服务端想发，客户端必需要接受(ack number = 456 +1 , seq = 654, ACK = 1)
            为了还能进行数据传输
        3.3 服务端发出【连接关闭】报文段(Fin = 1 , ACK = 1, seq = 789, ack number = 456 + 1)
        3.4 客户端发出【确认】，通知服务端连接已关闭(ACK = 1 , seq = 456 + 1, ack = 789 +1)
    4.为什么要四次握手（全双工通信，每个方向都要关闭）
        因为连接时，建立连接的SYN 和 确认号 ACK是一次发送的；
        释放连接时，FIN 和 ACK是两次发送的。因为可能收到连接释放后，可能还有数据要传输，所以先发送ACK确认，然后等数据传输完了，再发送Fin告知断开连接。
    5.为什么四次握手后要等待两个MSL
        1.为了最后一个确认能到达服务端，不然服务端未接收到会超时重传
        2.防止以已经失效的连接请求再次到达，使得所有报文段全部消失
    6.为什么不是【两次握手】
        1.假如服务端收到连接请求，然后发送同意，两次握手情况下，连接就已经建立了，这个时候服务端可以开始发送数据。
        但如果网络不可靠，客户端【未收到同意连接】，以为连接未建立，对于发送来的数据是忽略的，更有可能重新发送请求连接报文。导致死锁
        2.假设客户端请求连接的报文，被【阻塞一段时间】后又发送回来了。服务端以为客户端又要连接，就向A确认连接，然后开始等待客户端发送数据，浪费服务器资源
![三次握手](https://pic3.zhimg.com/v2-576b043d12353928eea6e45373655668_r.jpg)
![四次握手](https://pic2.zhimg.com/v2-c8b61ed2a249700583b11bc5d16c5711_r.jpg)
# 3.